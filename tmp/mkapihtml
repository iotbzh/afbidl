#/bin/sh
set -e

f="$1"
test -f "$f"

t="$(mktemp)"

y2j() {
 python -c 'import sys, yaml, json; y=yaml.load(sys.stdin.read()); print(json.dumps(y))'
}

sed 's%[$]\(/[^ \t]*\)%{ $ref: "#\1" }%' "$f" | \
 y2j | \
 afb-exprefs |
 jq . > "$t"


mustach "$t" api.html.must
rm "$t"
